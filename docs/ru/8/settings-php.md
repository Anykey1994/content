---
id: settings-php
title: settings.php — настройки сайта
core: 8
metatags:
  title: 'Drupal 8: settings.php — настройки сайта'
  description: 'Обзор возможных настроек сайта.'
---

**settings.php** — файл с настройками для конкретного сайта. Данный сайт содержит специфичные настройки для конкретного сайта.

В данном файле настраиваются такие параметры как подключение к базе данных, пути до конфигураций, соль и т.д. Он может быть использован сторонними модулями для управления собственным поведением, для этого присутствует соответствующий API.

Настройки, в отличие от конфигураций, предназначены только для хранения read-only значений, которые необходимы на очень ранних этапах запуска ядра. Иными словами, это настройки, которые определяют значения для текущего окружения.

Файл является read-only и Drupal регулярно проверяет что данный файл защищён от записи. Прежде чем вносить правки в данный файл на действующем сайте, убедитесь что у вашего пользователя есть права на его запись.

## Где находится settings.php?

Чаще всего вы можете обнаружить данный сайт по пути `/sites/default`, но это зависит от того, как произведена настройка Drupal и какой подход в разработке был использован.

По умолчанию проверяется только `/sites/default`, но если вы настроите мультисайтинг (присутствует `/sites/sites.php`), то поиск будет происходит по различным директориям.

Рассмотрим на примере. Если Drupal установлен по пути `https://www.drupal.org:8080/mysite/test/` то файл **settings.php** будет искаться в следующих директориях, в порядке приоритета:

- sites/8080.www.drupal.org.mysite.test
- sites/www.drupal.org.mysite.test
- sites/drupal.org.mysite.test
- sites/org.mysite.test
- sites/8080.www.drupal.org.mysite
- sites/www.drupal.org.mysite
- sites/drupal.org.mysite
- sites/org.mysite
- sites/8080.www.drupal.org
- sites/www.drupal.org
- sites/drupal.org
- sites/org
- sites/default

## Программное получение настроек

В Drupal присутствует специальный утилитарный объект `\Drupal\Core\Site\Settings`. При помощи данного объекта вы можете получать актуальные настройки которые используются для текущего запроса.

### get()

Возвращает значение конкретной настройки, принимает два аргумента:

- `$name`: Название настройки значение которой необходимо получить.
- `$default = NULL`: (опционально) Значение по умолчанию, если оно не найдено в файле.

Данный метод вызовет ошибку если вы захотите получить значение для `install_profile`. Если вы хотите получить название инсталяционного профиля используйте [сервис](services/services.md) `install_profile`.

**Пример:**

```php
$batch_size = Settings::get('entity_update_batch_size', 50);
```

### getAll()

Возвращает все настройки и предназначен только для тестирования.

```php
$settings = Settings::getAll();
```

### getHashSalt()

Возвращает значение настройки `hash_salt`. Если данной настройки нет или она является пустой, то вызывается исключение.

```php
$salt = Settings::getHashSalt();
```

## Структура settings.php

### $config_directories

> [!NOTE]
> Данная настройка признана устаревшей и, вместо неё необходимо указывать `$settings['config_sync_directory']`. Для более подробной информации изучите соответствующее изменения [Drupal 8.8.0](releases/release-8.8.0.md).

Массив `$config_directories` задаёт пути в файловой систему до путей где необходимо хранить конфигурации. В процессе [установки Drupal](installation.md) создаётся директория `sync`, которая используется для импортирования конфигураций. Также может быть указана `active` директория для хранения актуальных конфигураций. По умолчанию `active` не задаётся, так как эта информация хранится в БД.

Данная настройка автоматически задаётся и добавляется в конец файла в процессе установки.

**Пример**:

```php
$config_directories = [
  CONFIG_SYNC_DIRECTORY => '/directory/outside/webroot',
];
```

### $settings

#### Соль

[Соль](https://ru.wikipedia.org/wiki/%D0%A1%D0%BE%D0%BB%D1%8C_(%D0%BA%D1%80%D0%B8%D0%BF%D1%82%D0%BE%D0%B3%D1%80%D0%B0%D1%84%D0%B8%D1%8F) используемая для генерации одноразовых ссылок, токенов форм, ссылок отписки и т.д.

Значение для данной переменной задаётся случайной генерацией в процессе установки. Если вы поменяете это значение на рабочем сайте, то все ссылки одноразового входа будут инвалидированы.

> [!NOTE] 
> Если вы размещаете один сайт на кластере серверов, убедитесь что у всех одинаковая соль, чтобы поведение было идентичным независимо от активного сервера.

Для более продвинутой защиты вы можете вынести значение соли за пределы Drupal и запрашивать его из файла или иных мест. Вы также должны убедиться что данный файл не попадает в бэкапы сайта и не хранится в БД.

**Пример:**

```php
$settings['hash_salt'] = file_get_contents('/home/example/salt.txt');
```

#### Идентификатор деплоя

Контейнер Drupal для [Dependency Injection](services/dependency-injection.md) автоматически инвалидируется и перестраивается при изменении версии ядра. Когда обновляете контриб или кастом модули которые меняют контейнер, изменение данного идентификатора также инвалидирует и перестроит контейнер как только код будет задеплоен.

**Пример:**

```php
$settings['deployment_identifier'] = \Drupal::VERSION;
```

#### Контроль доступа для update.php

Когда вы обновляете Drupal при помощи `/update.php` производится проверка на наличие прав доступа «Управление обновлениями» (`administer software updates`) у пользователя. Если у пользователя нету данных прав, то обновление не будет запущено.

Благодаря этой настройке вы можете временно отключить данную проверку, если по каким-то причинам у вас нет возможности авторизоваться под соответствующим пользователем или пользователя с такими правами не существует.

> [!IMPORTANT]
> Не забудьте включить проверку прав доступа после успешного запуска.

Значение `TRUE` — пропускает проверку прав, `FALSE` (по умолчанию) — будет проверять права доступа.

**Пример:**

```php
$settings['update_free_access'] = FALSE;
```

> [!TIP]
> Вы можете использовать [Drush](../drush.md) команду `drush updb` для применения обновления из терминала.

