---
id: forms
title: Формы
core: 8
search-keywords:
  - как создать добавить объявить форму
  - собственные кастомные формы
metatags:
  title: 'Drupal 8: Формы'
  description: 'Узнайте как создавать, модифицировать, валидировать и обрабатывать формы в Drupal 8.'
category:
  area: Формы
  title: Введение
  order: 1
---

**Form API** позволяет вам объявлять собственные формы, их структуру, валидацию и отправку.
 
Описание самой формы происходит при помощи render array, который в дальнейшем преобразуется в HTML и отображается клиенту. Когда пользователь отправляет форму, Drupal автоматически производит обработку входящих данных и передает форме на валидацию и отправку. Вы полностью контролируете процесс формы, от её создания, до её отправки без необходимости использовать HTML.

Описание форм при помощи структурированных массивов, вместо использования обычного HTML имеет некоторые преимущества:

- Стабильная разметка для всех форм на сайте, поддающаяся модификации при помощи тем.
- Формы, объявленные одним модулем, могут быть легко изменены другим модулем при помощи [хуков](../hooks/hooks.md), без необходимости производить сложные операции или что-либо хакать.
- Комплексные элементы форм, например, загрузка файлов или виджет рейтинга, могут быть объявлены как компоненты и использоваться в любых формах и любом количестве, автоматически со всей необходимой логикой обработки данных полученных в форме, предоставляя готовый результат.

## Обязательные методы

Все данные формы реализуют `FormInterface`, поэтому имеют ряд обязательных методов.

### getFormId()

Данный метод возвращает идентификатор формы. Он должен быть уникальным, состоять из латиницы и знаков подчеркивания `_`.

Данное значение будет использоваться для идентификации формы другими модулями, что позволяет их модифицировать не трогая оригинальный код.

```php
  public function getFormId() {
    return 'mymodule_settings';
  }
```

### buildForm()

Данный метод должен возвращать render array со структурой формы и всеми её элементами.

```php
  public function buildForm(array $form, FormStateInterface $form_state) {
    $form['phone_number'] = [
      '#type' => 'tel',
      '#title' => 'Example phone',
    ];
        
    $form['submit'] = [
      '#type' => 'submit',
      '#value' => $this->t('Submit'),
    ];

    return $form;
  }
```

## Валидация форм

После того как пользователь заполнит форму и нажмет на кнопку отправки, Drupal вызовет метод `validateForm()`, если он реализован у формы.

Метод `validateForm()` принимает следующие аргументы:

- `array &$form`: Рендер массив формы передаваемый по ссылке, с возможностью модифицировать форму.
- `FormStateInterface $form_state`: Объект содержащий состояние формы на момент вызова. 

При помощи `$form_state`, вы можете получать как все значения сразу `getValues()`, так и какое-то конкретное `getValue('from_element_name')`. Также данный объект позволяет установить ошибку для формы, и прервать её отправку, отобразив пользователю ошибку. Для этого присутствуют два метода `setError()` - устанавливает ошибку в целом, для формы, а также `setErrorByName()` - устанавливает ошибку на конкретный элемент формы, выводя сообщение об ошибке, а также подсвечивая элемент формы с ошибкой.

Установка ошибки автоматически прервет выполнение формы и потребует у пользователя исправить ошибки, поэтому указывайте причину ошибки.

```php
/**
 * {@inheritdoc}
 */
public function validateForm(array &$form, FormStateInterface $form_state) {
  if (strlen($form_state->getValue('phone_number')) < 3) {
    $form_state->setErrorByName('phone_number', $this->t('The phone number is too short. Please enter a full phone number.'));
  }
}
```

## Отправка / обработка данных формы

В конечном итоге будет вызван метод `submitForm()` со схожими аргументами как у `validateForm()`.

В данном методе происходит финальная работа с данными, отправленными пользователем. Тут будет находиться бизнес-логика или её вызов.

Пример обработчика формы, который выводит сообщение после успешной отправки с введенным номером телефона.

```php
/**
 * {@inheritdoc}
 */
public function submitForm(array &$form, FormStateInterface $form_state) {
  drupal_set_message($this->t('Your phone number is @number', ['@number' => $form_state->getValue('phone_number')]));
}
```
