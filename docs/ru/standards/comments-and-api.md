---
id: standards-comments-and-api
title: Стандарты API документации и комментариев
path: /standards/api-and-comments
metatags:
  title: 'Drupal: Стандарты описания API и комментариев к коду'
  description: 'Стандарты о том, как правильно описывать и документировать свой код в комментариях.'
category:
  area: Стандарты кодирования
  order: 3
  title: API документация и комментарии
---

На данной странице описаны стандаты, покрывающие написание комментариев к коду, а также, как документировать его API.

## Заметки и стандарты

### Общие соображения по разбору модулем API

Модуль API парсит как документацию, так и сам код PHP файлов. Ожидается что они будут в едином формате, который похож на PHPDoc, JavaDoc и т.д. Изначально документация базировалась на Doxygen, но затем переросла его и появились свои собственные теги, а также специфичный для Drupal функционал.

Модуль API парсит документацию, которая находится в специальных документационных блоках (также известных как "docblocks").

Пример синтаксиса docblock:

```php
/**
 * Sample summary line.
 *
 * Next paragraph. Etc.
 */
(code being documented goes here, such as a function declaration, class, etc.)
```

Общие заметки касаемо модуля API и документации, которую он будет парсить:

- Модуль API считает следующие расширения файлов, как расширения PHP: .php, .module, .inc, .install, .engine, .theme, .profile и .test.
- Когда парсится PHP файл, модуль API парсит как документацию, так и непосредственно PHP код. PHP файлы с синтаксическими ошибками, могут привести к проблемам.
- Документация распознается только по специальным PHP комментариям, которые начинаются с `/**`.
- Одностроковые комментарии внутри кода, начинающиеся с `//` и комментарии начинающиеся с `/*` не распознаются как docblock.
- Документационные блоки обычно имеют `*` в начали каждой линии, которые модуль API срезает при формировании документации.
- Для разделения абзацев используется пустая строка. Некоторые теги также вызвают принудительное завершение параграфа: `@param`, `@return`, `@see`, `@var`. Модуль API не понимает документацию, если она состоит только из одиночного тега, например `@param`.
- Модуль API не беспокоится о длине строки комментария, тем не менее, Drupal стандарты имеют жесткие требования на данный счёт.
- Первый абзац документационного блока также известен как _сводка_.
- Для того чтобы задокументировать функцию, класс и т.д., документационный блок должен находиться прямо перед началом структуры, без пустых линий между ними. В стандарте также имеются несколько документационных блоков, которые "сами по себе".
- Модуль API автоматически превращает в ссылки все распознанные функции, классы и т.д.

### Общие стандарты документирования API

В данном разделе собраны заметки и стандарты относительно всех документационных блоков.

Пример:

```php
/**
 * Sample summary line.
 *
 * Next paragraph. Etc.
 */
(code being documented goes here, such as a function declaration, class, etc.)
```

- Вся документация и комментарии должны быть в соответствующей форме, использовать правильную грамматику и пунктуацию, а также следовать общим указаниям на счёт содержимого drupal.org: <https://drupal.org/style-guide/content>.
- Добавляйте пробел между символами комментария (`*` или `//`) и первым сиволом предложения.
- Документация должна отражать актуальную версию кода, а не отличия от предыдущей или планы на будущую (за исключением `@todo` и `@deprecated` тегов).
- Предложения должны быть разделены одиночным пробелом.
- Комментарии и названия переменных должны быть на английском языке, а также использовать правописание английского языка США, а не Великобритании (например, "color", а не "colour").
- Для того чтобы сослаться на тему или модуль, используйте формулировку и заглавные буквы, например "the Foo Bar module".
- Капсом разрешено описывать только константы, например `TRUE`.
- Документационные блоки должны иметь `*` в начале каждой линии.
- Линии содержающие комментарии, включая документационные блоки, должны быть как можно ближе к 80 символам, но не длиннее данного значения. Есть несколько исключений, они будут описаны отдельно.
- Линии после тегов, таких как `@param`, `@return` и т.д., должны содержать документацию под данным тегом, а также дополнительно быть сдвинуты двумя пробелами.
- Каждая функция, константа, класс, интерфейс, а также составные класса (методы, свойства, константы), как и сам файл, должны быть задокументированы, даже те, что являются приватными.
- Все _сводки_ (первая линия документационного блока) должны быть короче 80 символов, начинаться с заглавной буквы и заканчиваться точкой (.). Они должны предоставлять краткое описание, что делает функция, что делает класс, что содержит файл и т.д.
- Когда вы реализуете [хук](../8/hooks/hooks.md), используйте краткую сводку в формате "Implements hook_name().". В данном случае, опустите описание параметров, возвращаемого значения и функции.

### Стандарты комментирования внутри кода

Настоятельно рекомендуется писать комментарии к коду по мере его написания. Общее правило заключается в том, что если вы смотрите на часть кода и думаете "Ничегосебе, прокомментирую позже.", вы должны прокомментировать данный код сейчас, пока вы помните как он работает. Комментарии должны быть непосредственно над кодом, который они комментируют. Например:

```php
// Disable recording of cached pages.
\Drupal::service('page_cache_kill_switch')->trigger();
```

Если каждому элементу списка необходимо добавить отдельный комментарий, то комментарии могут быть на той же линии что и элемент списка, и быть отформатированными с отступом до комментария. Но лучше всего, разделяйте комментарии и элементы списка, как в данном примере:

```php
$defaults = [
// (required) The name of the route this task links to.
'route_name' => '',
// Parameters for route variables when generating a link.
'route_parameters' => [],
// The static title for the local task.
'title' => '',
];
```

C-подобные комментарии (`/* */`) и стандартные комментарии C++ (`//`) допускаются, тем не менее, лучше используйте `//`, даже для многострочных комментариев (повторяя `//` для каждой строки). Использование комментариев в Perl\shell\YAML формате (`#`) для PHP кода не рекомендуется.

`@todo` тег должен следовать тем же правилам форматирования, что и для документационных блоков (дополнительные два пробела для второй и последующих строк). Пример:

```php
// Some other comment here.
// @todo Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed
//   diam nonumy eirmod tempor invidunt ut labore et dolore magna
//   aliquyam erat, sed diam voluptua.
// We explicitly delete all comments.
comment_delete($cid); 
```

### Сдантарты документирования API для функций

Документирование функций, в какой-то степени, более сложный процесс, чем документироавние других структур в PHP, поэтому они имеют свои собственные стандарты:

- Каждый параметр функции должен быть задокументирован используя тег `@param`. Кроме исключений описаных ниже.
- Если функция возвращает значение, оно должно быть задокументировано используя тег `@return`. Кроме исключений описаных ниже.
- Для большинства функций (кроме исключений ниже), сводка должна начинаться с глагола настоящего времени, в третьем лице и единственном числе, объясняя при этом, что делает функция. Например "Calculates the maximum weight for a list." (Рассчитывает максимальный вес для списка.).
- Функции, чью задачу легко описать в сводке, могут содержать только строку со сводкой (игнорируя описание параметров и возвращаемого значения).

В дополнение к этому, также имеются стандарты по документированию особых типов функций:

#### Описание хука

**Описание или определение хука** — документирования конкретного хука, который объявлен текущим модулем.

Сводка должна начинаться с императивного глагола, который описывает, зачем другим модулям может пригодиться данный хук. Например: "Отвечает при удалении содержимого.". Определения хуков помещаются в файлах `.api.php`, которые не используются Drupal напрямую.

Описание каждого конкретного хука состоит из фиктивной функции начиющейся с `hook`, а тело функции показывает пример использования данного хука. Все параметры и возвращаемые значения должны быть задокументированы.

Пример:

```php
/**
 * The user just logged in.
 *
 * @param \Drupal\user\UserInterface $account
 *   The user object on which the operation was just performed.
 */
function hook_user_login(UserInterface $account) {
  $config = \Drupal::config('system.date');
  // If the user has a NULL time zone, notify them to set a time zone.
  if (!$account->getTimezone() && $config->get('timezone.user.configurable') && $config->get('timezone.user.warn')) {
    \Drupal::messenger()
      ->addStatus(t('Configure your <a href=":user-edit">account time zone setting</a>.', [
        ':user-edit' => $account->toUrl('edit-form', [
          'query' => \Drupal::destination()
            ->getAsArray(),
          'fragment' => 'edit-timezone',
        ])->toString(),
      ]));
  }
}
```

#### Реализация хука

**Реализация хука** — использование существующего хука в своём модуле.

Документирование таких функций используют короткий формат сводки.

```php
/**
 * Implements hook_help().
 */
function blog_help($section) {
```

При необходимости вы можете указать дополнительные детали, относящиеся к реализации конкретного хука отдельным абзацем после сводки.

Не документируйте параметры и возвращаемые значения, а также что делает хук (если это не относится к конкретно вашему варианту реализации хука), всё это находится в описании хука.

Если хук содержит динамический кусок для подстановки, необходимо указать, для чего данная подстановка будет использована.

```php
/**
 * Implements hook_form_FORM_ID_alter() for node_type_form.
 */
function mymodule_form_node_type_form_alter(&$form, &$form_state) { 
```

#### Функции обновления

К функциям обновления относятся реализации хуков `hook_update_N()` и `hook_post_update_NAME()`.

Данные хуки обрабатываются особенным способом. Сводка данного хука (первая строка комментария) будет отображена пользовтелю как описание ожидающего обновления при запуске update.php. Она должна описывать какие задачи решает данное обновление.

При необходимости, дополнительное описание может идти со второго абзаца.

```php
/**
 * Add several fields to the {node_revision} table.
 *
 * Longer description can go here, if necessary.
 */
function module_name_update_8701() { 
```

Обратите внимание что сводка должна начинаться с повелительного глагола.

@TODO

## Ссылки

- [API documentation and comment standards](https://www.drupal.org/docs/develop/standards/api-documentation-and-comment-standards) (англ.), drupal.org